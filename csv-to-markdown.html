<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>CSV â†’ Markdown Table å¤‰æ›ãƒ„ãƒ¼ãƒ«</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        padding: 30px;
        background: #f9fafb;
      }

      .btn {
        background: #007bff;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px 14px;
        cursor: pointer;
        margin-right: 10px;
      }

      .btn:hover {
        background: #0056b3;
      }

      #csvFile {
        margin-right: 10px;
      }

      #output {
        width: 100%;
        height: 400px;
        padding: 10px;
        font-family: monospace;
        border: 1px solid #ccc;
        border-radius: 6px;
        resize: vertical;
      }
    </style>
    <link rel="stylesheet" href="sample.css" />
    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
      <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
    <![endif]-->
    <script src="sample.js"></script>
  </head>

  <body>
    <h2>ğŸ“„ CSV â†’ Markdown Table å¤‰æ›ãƒ„ãƒ¼ãƒ«</h2>
    <div class="action-row">
      <input type="file" id="csvFile" accept=".csv" />
      <button class="btn" id="convertBtn">å¤‰æ›ã™ã‚‹</button>
      <button class="btn" id="downloadBtn" style="display: none">
        Markdownã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      </button>
    </div>

    <h3>å‡ºåŠ›çµæœ</h3>
    <textarea id="output" readonly></textarea>

    <script>
      document
        .getElementById("convertBtn")
        .addEventListener("click", async () => {
          const fileInput = document.getElementById("csvFile");
          const output = document.getElementById("output");
          const downloadBtn = document.getElementById("downloadBtn");

          if (!fileInput.files.length) {
            alert("CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
            return;
          }

          const file = fileInput.files[0];
          const arrayBuffer = await file.arrayBuffer();

          // Shift_JISã§ãƒ‡ã‚³ãƒ¼ãƒ‰
          const decoder = new TextDecoder("shift-jis");
          const text = decoder.decode(arrayBuffer);

          // åŒºåˆ‡ã‚Šæ–‡å­—è‡ªå‹•åˆ¤å®šï¼ˆã‚¿ãƒ– or ã‚«ãƒ³ãƒï¼‰
          const delimiter = text.includes("\t") ? "\t" : ",";

          // CSVã‚’è¡Œã”ã¨ã«åˆ†å‰²
          const rows = text
            .trim()
            .split(/\r?\n/)
            .map((line) => line.split(delimiter));

          // NaNã‚„ç©ºæ¬„ã‚’ "null" ã«ç½®æ› ï¼‹ ãƒ€ãƒ–ãƒ«ã‚¯ã‚ªãƒ¼ãƒˆå‰Šé™¤
          const cleanRows = rows.map((row) =>
            row.map((cell) => {
              const trimmed = cell.trim();
              if (trimmed === "") return "null";
              return trimmed.replace(/^"|"$/g, ""); // â† ã“ã‚ŒãŒãƒã‚¤ãƒ³ãƒˆï¼
            })
          );

          // Markdown ãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆ
          const headers = cleanRows[0];
          const dataRows = cleanRows.slice(1);

          let markdown = `| ${headers.join(" | ")} |\n`;
          markdown += `|${headers.map(() => "---").join("|")}|\n`;
          dataRows.forEach((row) => {
            markdown += `| ${row.join(" | ")} |\n`;
          });

          output.value = markdown;
          downloadBtn.style.display = "inline-block";
        });

      // Markdown ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      document.getElementById("downloadBtn").addEventListener("click", () => {
        const text = document.getElementById("output").value;
        const blob = new Blob([text], { type: "text/markdown;charset=utf-8" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "output.md";
        link.click();
      });
    </script>
  </body>
</html>
